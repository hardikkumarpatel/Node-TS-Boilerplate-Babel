{"version":3,"file":"Socket.helper.js","names":["_socket","require","_","asyncGeneratorStep","n","t","e","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","SocketAppHelper","constructor","app","IO","Server","HttpServer","cors","origin","connectionStateRecovery","allowEIO3","App","set","global","initialize","_this","on","_ref","socket","Log","info","concat","id","reason","error","SocketException","Error","_x","emitSocketEvents","req","room","event","payload","get","in","emit","acknowledgment","callback","status","_default","exports","default"],"sources":["../../../src/helpers/socket/Socket.helper.ts"],"sourcesContent":["import { Request } from \"express\";\nimport { DisconnectReason, Server, Socket } from \"socket.io\";\nimport { Log } from \"@/helpers\";\nimport ExpressEngine from \"@/app\";\n\nclass SocketAppHelper {\n  public IO: Server;\n  constructor(app: typeof ExpressEngine) {\n    this.IO = new Server(app.HttpServer, {\n      cors: {\n        origin: \"*\"\n      },\n      connectionStateRecovery: {},\n      allowEIO3: true\n    });\n    app.App.set(\"IO\", this.IO);\n    (global as any).IO = this.IO;\n  }\n\n  public async initialize(): Promise<string> {\n    this.IO.on(\"connection\", async (socket: Socket) => {\n      try {\n        Log.info(`Socket is connected ${socket.id}`);\n\n        socket.on(\"disconnect\", (reason: DisconnectReason) => {\n          Log.error<string>(`socket ${socket.id} disconnected due to`, reason);\n        });\n      } catch (SocketException: unknown) {\n        if (SocketException instanceof Error) {\n          Log.error<Error>(\"Error ocurred in socket app\", SocketException);\n        }\n      }\n    });\n    return `Socket engine connected and initialized ðŸš€`;\n  }\n\n  public static async emitSocketEvents<T>(\n    req: Request,\n    room: string,\n    event: string,\n    payload: T\n  ): Promise<void> {\n    const IO: Server = req.app.get(\"IO\");\n    IO.in(room).emit(event, payload);\n  }\n\n  public static acknowledgment(callback?: (response: { status: string }) => void): void {\n    if (callback && typeof callback === \"function\") {\n      callback({ status: \"OK\" });\n    }\n  }\n}\n\nexport default SocketAppHelper;\n"],"mappings":"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","ignoreList":[]}