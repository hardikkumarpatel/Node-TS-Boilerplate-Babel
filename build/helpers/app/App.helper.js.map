{"version":3,"file":"App.helper.js","names":["_httpStatusCodes","_interopRequireWildcard","require","_","_config","_getRequireWildcardCache","e","WeakMap","r","t","__esModule","default","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","asyncGeneratorStep","o","c","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","_defineProperty","_toPropertyKey","enumerable","configurable","writable","_toPrimitive","Symbol","toPrimitive","TypeError","String","Number","AppHelper","serverErrorListening","error","syscall","code","Log","info","process","exit","concat","Config","IConfigKey","PORT","listening","server","address","port","signalListening","app","http","on","close","SIGINTError","Error","_GraphQL","_IO","_MongoDB","global","GraphQL","stop","IO","MongoDB","disconnect","kill","pid","UncaughtError","_GraphQL2","_IO2","_MongoDB2","UncaughtReason","validate","NODE_ENV","req","res","platform","uptime","env","status","StatusCodes","OK","json","ApiResponseHelper","cwd","ApiErrorResponseHelper","NOT_FOUND","getReasonPhrase","_default","exports"],"sources":["../../../src/helpers/app/App.helper.ts"],"sourcesContent":["import express, { Request, Response } from \"express\";\nimport HTTP from \"node:http\";\nimport { AddressInfo } from \"node:net\";\nimport { Server } from \"socket.io\";\nimport mongoose from \"mongoose\";\nimport StatusCodes, { getReasonPhrase } from \"http-status-codes\";\nimport { ApiErrorResponseHelper, ApiResponseHelper, Log } from \"@/helpers\";\nimport { Config, IConfigKey } from \"@/config\";\nimport { ApolloServer } from \"@apollo/server\";\nclass AppHelper {\n  public static async serverErrorListening(error: NodeJS.ErrnoException): Promise<void> {\n    if (error.syscall !== \"listen\") {\n      throw error;\n    }\n\n    switch (error.code) {\n      case \"EACCES\":\n        Log.info(\"Requires privileges\");\n        return process.exit(1);\n\n      case \"EADDRINUSE\":\n        Log.error(`${Config.get<number>(IConfigKey.PORT)} is already in use`);\n        return process.exit(1);\n\n      default:\n        throw error;\n    }\n  }\n\n  public static async listening(server: HTTP.Server): Promise<void> {\n    const address: AddressInfo = <AddressInfo>server.address();\n    Log.info(`Express engine is running on ${address.port} 🚀`);\n  }\n\n  public static signalListening(app: express.Application): void {\n    const http: HTTP.Server = app.get(\"HttpServer\");\n    process\n      .on(\"SIGINT\", async () => {\n        try {\n          http.close();\n        } catch (SIGINTError: unknown) {\n          if (SIGINTError instanceof Error) {\n            Log.error(`Error occurred during shutdown server`, SIGINTError);\n          }\n        } finally {\n          ((global as any).GraphQL as ApolloServer)?.stop();\n          ((global as any).IO as Server)?.close();\n          ((global as any).MongoDB as typeof mongoose)?.disconnect();\n          Log.info(`Express engine and all running instance are shutdown successfully 🌱`);\n          process.exit(1);\n        }\n      })\n      .on(\"SIGTERM\", () => {\n        if (http) {\n          http.close();\n        }\n      })\n      .on(\"SIGHUP\", () => {\n        process.kill(process.pid, \"SIGTERM\");\n      })\n      .on(\"uncaughtException\", (UncaughtError: Error) => {\n        Log.error(`Uncaught Exception thrown`, UncaughtError);\n        http.close();\n        ((global as any).GraphQL as ApolloServer)?.stop();\n        ((global as any).IO as Server)?.close();\n        ((global as any).MongoDB as typeof mongoose)?.disconnect();\n        process.exit(1);\n      })\n      .on(\"unhandledRejection\", (UncaughtReason: Error) => {\n        Log.error(`Unhandled Rejection thrown`, UncaughtReason);\n        process.exit(1);\n      });\n  }\n\n  public static useAppHealthRoute = (req: Request, res: Response): Response => {\n    const { platform, pid, uptime, env } = process;\n    return res.status(StatusCodes.OK).json(\n      new ApiResponseHelper<Record<string, unknown>>(\n        StatusCodes.OK,\n        \"Welcome to backend! made in NODE with ❤️\",\n        {\n          platform,\n          pid,\n          uptime: uptime(),\n          env: env.NODE_ENV,\n          cwd: process.cwd()\n        }\n      )\n    );\n  };\n\n  public static useAppNotFoundRoute = (): void => {\n    throw new ApiErrorResponseHelper(\n      StatusCodes.NOT_FOUND,\n      getReasonPhrase(StatusCodes.NOT_FOUND),\n      \"Request resource not found\"\n    );\n  };\n\n  public static async validate(): Promise<boolean> {\n    if (!Config.get<number>(IConfigKey.PORT) || !Config.get<string>(IConfigKey.NODE_ENV)) {\n      Log.error<string>(\n        \"The node env or PORT mapping is missing! Please check the .env file for the correct mapping.\"\n      );\n      Log.error<string>(\"x-----------------------------------------------x\");\n      Log.error<string>(\"x==================== ERROR ====================x\");\n      Log.error<string>(\"x-----------------------------------------------x\");\n      return false;\n    }\n    return true;\n  }\n}\n\nexport default AppHelper;\n"],"mappings":"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","ignoreList":[]}