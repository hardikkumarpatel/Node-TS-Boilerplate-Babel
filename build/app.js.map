{"version":3,"file":"app.js","names":["require","_express","_interopRequireDefault","_cors","_helmet","_cookieParser","_nodeHttp","_nodePath","_passport","_helpers","_swagger","_config2","_middleware","_Graphql","_routes","e","__esModule","default","asyncGeneratorStep","n","t","r","o","a","c","i","u","value","done","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","ExpressEngine","run","AppHelper","validate","process","exit","startEngine","signalListening","catch","Log","error","App","express","HttpServer","HTTP","createServer","set","Config","get","IConfigKey","PORT","on","serverErrorListening","info","listening","initialize","listen","initializeMiddleware","setupRequestMiddleware","initializeRoutes","initializeSwaggerDocs","initializeSocket","initializeGraphQLServer","initializeGlobalMiddleware","_this","use","urlencoded","limit","extended","json","MorganLogMiddleware","success","static","path","cors","origin","methods","helmet","contentSecurityPolicy","cookies","_this2","req","res","next","_req$entity","entity","_this3","passport","PassportJWTMiddleware","JWTStrategy","useAppHealthRoute","routes","SwaggerApp","SocketAppHelper","GraphQLServer","_this4","useAppNotFoundRoute","ErrorHelperMiddleware","_default","exports"],"sources":["../src/app.ts"],"sourcesContent":["import \"dotenv/config\";\nimport express, { Request, Response, NextFunction } from \"express\";\nimport cors from \"cors\";\nimport helmet from \"helmet\";\nimport cookies from \"cookie-parser\";\nimport HTTP from \"node:http\";\nimport path from \"node:path\";\nimport passport from \"passport\";\nimport { Log, AppHelper, SocketAppHelper } from \"@/helpers\";\nimport { SwaggerApp } from \"@/swagger\";\nimport { Config, IConfigKey } from \"@/config\";\nimport { ErrorHelperMiddleware, MorganLogMiddleware, PassportJWTMiddleware } from \"@/middleware\";\nimport GraphQLServer from \"@/api/graphql/Graphql.server\";\nimport MongoDBConnection from \"@/database/mongodb/connection/Mongo.connection\";\nimport routes from \"@/routes\";\n\nclass ExpressEngine {\n  public static App: express.Application;\n  public static HttpServer: HTTP.Server;\n\n  public static async run(): Promise<void> {\n    if (!(await AppHelper.validate())) process.exit(1);\n    await ExpressEngine.startEngine().then(AppHelper.signalListening).catch(Log.error);\n  }\n\n  public static async startEngine(): Promise<express.Application> {\n    ExpressEngine.App = express();\n    ExpressEngine.HttpServer = HTTP.createServer(ExpressEngine.App);\n    ExpressEngine.App.set(\"HttpServer\", ExpressEngine.HttpServer);\n    ExpressEngine.App.set(\"port\", Config.get<number>(IConfigKey.PORT));\n    ExpressEngine.HttpServer.on(\"error\", AppHelper.serverErrorListening);\n    ExpressEngine.HttpServer.on(\"close\", Log.info);\n    ExpressEngine.HttpServer.on(\n      \"listening\",\n      async () => await AppHelper.listening(ExpressEngine.HttpServer).then(ExpressEngine.initialize)\n    );\n    ExpressEngine.HttpServer.listen(Config.get<number>(IConfigKey.PORT));\n    return ExpressEngine.App;\n  }\n\n  private static async initialize(): Promise<void> {\n    // await MongoDBConnection.connect();\n    await ExpressEngine.initializeMiddleware();\n    await ExpressEngine.setupRequestMiddleware();\n    await ExpressEngine.initializeRoutes();\n    await ExpressEngine.initializeSwaggerDocs();\n    await ExpressEngine.initializeSocket();\n    await ExpressEngine.initializeGraphQLServer();\n    await ExpressEngine.initializeGlobalMiddleware();\n  }\n\n  private static async initializeMiddleware(): Promise<void> {\n    this.App.use(express.urlencoded({ limit: \"6kb\", extended: true }));\n    this.App.use(express.json({ limit: \"6kb\" }));\n    this.App.use(new MorganLogMiddleware().success);\n    this.App.use(new MorganLogMiddleware().error);\n    this.App.use(\"/upload\", express.static(path.resolve(\"src\", \"upload\")));\n    this.App.use(\n      cors({\n        origin: \"*\",\n        methods: [\"GET\", \"HEAD\", \"PUT\", \"OPTIONS\", \"PATCH\", \"POST\", \"DELETE\"]\n      })\n    );\n    this.App.use(helmet({ contentSecurityPolicy: false }));\n    this.App.use(cookies());\n  }\n\n  private static async setupRequestMiddleware(): Promise<void> {\n    this.App.use((req: Request, res: Response, next: NextFunction) => {\n      req.entity ??= {};\n      next();\n    });\n  }\n\n  private static async initializeRoutes(): Promise<void> {\n    this.App.use(passport.initialize());\n    passport.use(new PassportJWTMiddleware().JWTStrategy);\n    this.App.use(\"/health\", AppHelper.useAppHealthRoute);\n    this.App.use(routes);\n  }\n\n  private static async initializeSwaggerDocs(): Promise<void> {\n    await new SwaggerApp(ExpressEngine).initialize().then(Log.info).catch(Log.error);\n  }\n\n  private static async initializeSocket(): Promise<void> {\n    await new SocketAppHelper(ExpressEngine).initialize().then(Log.info).catch(Log.error);\n  }\n\n  private static async initializeGraphQLServer(): Promise<void> {\n    await new GraphQLServer(ExpressEngine).initialize().then(Log.info).catch(Log.error);\n  }\n\n  private static async initializeGlobalMiddleware(): Promise<void> {\n    this.App.use(\"*\", AppHelper.useAppNotFoundRoute);\n    this.App.use(ErrorHelperMiddleware.use);\n  }\n}\n\nexport default ExpressEngine;\n"],"mappings":"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","ignoreList":[]}