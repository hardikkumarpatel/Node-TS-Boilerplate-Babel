{"version":3,"file":"Error.middleware.js","names":["_multer","require","_helpers","_config","_httpStatusCodes","ownKeys","e","r","t","Object","keys","getOwnPropertySymbols","o","filter","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","arguments","length","forEach","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_toPropertyKey","value","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","ErrorHelperMiddleware","errors","_req","res","_next","MulterError","ErrorHelper","capture","error","statusCode","ApiErrorResponseHelper","StatusCodes","INTERNAL_SERVER_ERROR","getReasonPhrase","message","stack","Config","isDev","Log","isProduction","map","err","_err$extensions","extensions","stacktrace","response","status","json","_default","exports","default"],"sources":["../../../src/middleware/error/Error.middleware.ts"],"sourcesContent":["import { Request, Response, NextFunction } from \"express\";\nimport { MulterError } from \"multer\";\nimport { ApiErrorResponseHelper, ErrorHelper, Log } from \"@/helpers\";\nimport { Config } from \"@/config\";\nimport { getReasonPhrase, StatusCodes } from \"http-status-codes\";\nimport { ErrorCapture } from \"@/helpers/api/ApiErrorResponse.helper\";\nclass ErrorHelperMiddleware {\n  public static use = (\n    errors: ApiErrorResponseHelper,\n    _req: Request,\n    res: Response,\n    _next: NextFunction\n  ) => {\n    /** Handle file uploads and address any unhandled errors. */\n    if (errors instanceof MulterError) {\n      return ErrorHelper.capture(errors, res);\n    }\n\n    /** Handle APIs errors */\n    let error = errors as ApiErrorResponseHelper;\n    if (!error.statusCode) {\n      error = new ApiErrorResponseHelper(\n        StatusCodes.INTERNAL_SERVER_ERROR,\n        getReasonPhrase(StatusCodes.INTERNAL_SERVER_ERROR),\n        errors.message,\n        errors.stack\n      );\n    }\n    if (Config.isDev()) {\n      Log.error<ApiErrorResponseHelper>(\"\", error);\n    }\n    if (Config.isProduction()) {\n      error.errors.map((err: ErrorCapture) => delete err.extensions?.stacktrace);\n    }\n    const response = {\n      ...error\n    };\n    return res.status(error.statusCode).json(response);\n  };\n}\n\nexport default ErrorHelperMiddleware;\n"],"mappings":"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","ignoreList":[]}